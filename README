# Repo for et enkelt oppsett for en enonic-xp app i kubernetes

Jeg har satt opp et cluster i google cloud som heter "enonic-xp-cluster", i et prosjekt som heter "enonic-xp-cloud".

## Spinne opp på ny maskin
# 1. Installere kubernetes & gcloud.
# 2. Aktivere google container registry API i google developer console.

# hente ned credentials for cluster
gcloud container clusters get-credentials enonic-xp-cluster

# Registrere image til google cloud:
cd enonic-xp
gcloud container builds submit --tag gcr.io/enonic-xp-cloud/enonic-xp-image .

# Nå kan du referere til dette bildet i k8s yaml filer: image: gcr.io/enonic-xp-cloud/enonic-xp-image - Se enonic-xp.yaml.

# Når imaget er registrert hos googles container register. Spinn opp enonix-xp, og eksponér port 8080 publicly:
kubectl apply -f enonic-xp.yaml
kubectl apply -f http-service.yaml


######
# Aktivere clustering funksjonalitet
######

# Sette opp filserver
https://console.cloud.google.com/launcher/details/click-to-deploy-images/singlefs?project=enonic-xp-cloud

# Noder må mounte filsystemet på filserveren for å sette blobstore path




################################################
### Sette opp elasticsearch for seg selv:
################################################

# elasticsearch & service-account:  https://github.com/kubernetes/examples/blob/master/staging/elasticsearch/README.md
kubectl create -f service-account.yaml
kubectl create -f elasticsearch-replication-controller.yaml
kubectl create -f service-account.yaml

## Todo:
Enonic xp docker bildet mangler oppsett for å koble mot elasticsearch serveren. elasticsarch.cfg filen må endres.
